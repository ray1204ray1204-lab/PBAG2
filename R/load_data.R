# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“¦ è¼‰å…¥åˆå§‹åŒ–è¨­å®š
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
source(here::here("R", "setup.R"))

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“Š è®€å–é«˜é½¡æŒ‡æ•¸è³‡æ–™
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
aging_file <- "aging_index_202412.csv"
aging_path <- file.path(path_population, aging_file)

if (file.exists(aging_path)) {
  aging_data <- safe_read_csv(aging_path)
  if (!is.null(aging_data)) {
    message("âœ… é«˜é½¡æŒ‡æ•¸è³‡æ–™å·²è¼‰å…¥ï¼š", nrow(aging_data), " ç­†")
  }
} else {
  warning("âš ï¸ æ‰¾ä¸åˆ°é«˜é½¡æŒ‡æ•¸è³‡æ–™ï¼š", aging_file)
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ¥ è®€å–é†«ç™‚å–®ä½è³‡æ–™ï¼ˆä¾é¡å‹ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
medical_files <- c(
  clinic            = paste0("clinic_", version_tag, ".csv"),
  medical_center    = paste0("medical_center_", version_tag, ".csv"),
  hospital_local    = paste0("hospital_local_", version_tag, ".csv"),
  hospital_regional = paste0("hospital_regional_", version_tag, ".csv"),
  pharmacy          = paste0("pharmacy_", version_tag, ".csv")
)

medical_data <- list()

for (type in names(medical_files)) {
  file_path <- file.path(path_medical, medical_files[[type]])
  if (file.exists(file_path)) {
    df <- safe_read_csv(file_path)
    if (!is.null(df)) {
      medical_data[[type]] <- df
      message("âœ… å·²è¼‰å…¥é†«ç™‚è³‡æ–™ï¼š", type, "ï¼ˆ", nrow(df), " ç­†ï¼‰")
    }
  } else {
    warning("âš ï¸ æ‰¾ä¸åˆ°é†«ç™‚è³‡æ–™ï¼š", medical_files[[type]])
  }
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ˜ï¸ è®€å–é–€ç‰Œåº§æ¨™è³‡æ–™ï¼ˆä¾åœ°å€ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
geo_data <- list()

for (region in region_list) {
  geo_file <- paste0(region, "_address_coordinates_", version_tag, ".csv")
  geo_path <- file.path(path_geo, geo_file)
  if (file.exists(geo_path)) {
    df <- safe_read_csv(geo_path)
    if (!is.null(df)) {
      geo_data[[region]] <- df
      message("âœ… å·²è¼‰å…¥é–€ç‰Œåº§æ¨™ï¼š", region, "ï¼ˆ", nrow(df), " ç­†ï¼‰")
    }
  } else {
    warning("âš ï¸ æ‰¾ä¸åˆ°åœ°å€åº§æ¨™æª”æ¡ˆï¼š", geo_file)
  }
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ  è®€å–ä¸å‹•ç”¢äº¤æ˜“è³‡æ–™ï¼ˆQ3ï¼‰
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
real_estate_files <- list.files(path_real_estate, pattern = "\\.csv$", full.names = TRUE)
real_estate_data <- list()

for (file in real_estate_files) {
  df <- safe_read_csv(file)
  if (!is.null(df)) {
    real_estate_data[[basename(file)]] <- df
    message("âœ… å·²è¼‰å…¥ä¸å‹•ç”¢è³‡æ–™ï¼š", basename(file), "ï¼ˆ", nrow(df), " ç­†ï¼‰")
  }
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# âœ… é¡¯ç¤ºå®Œæˆè¨Šæ¯
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
message("ğŸ‰ æ‰€æœ‰è³‡æ–™è®€å–ä½œæ¥­å·²å®Œæˆã€‚")